<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <title>Building your own QMS Sensor</title>
    <meta http-equiv="keywords" content="Validation">
    <meta http-equiv="keywords" content="S/TDC">
    <meta http-equiv="keywords" content="QMS">
    <meta http-equiv="keywords" content="QoS">
    <meta http-equiv="keywords" content="Metrics">
    <meta http-equiv="keywords" content="Services">
    <link href="mailto:info@stdc.com" rev="made">
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <link href="../stylesheets/index.css" rel="stylesheet" type="text/css">
  </head>
  <body bgcolor="#ffffff">
    <p class="center">
      <a href="http://www.stdc.com/">
        <img class="center" src="../images/stdchead2logo.gif" alt="S/TDC"
	     border=0 height="42" width="629">
      </a>
   </p>
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Building your own QMS Sensor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Now let us walk through the process of building your own sensor. We'll use the Hello_World Sensor as an example to ground the discussion. It involves a certain amount of planning, some amount of design and a lot of cut-and-paste code. First we define what this Sensor should do. In our example, we want the Sensor to listen for a request that contains a first name and a last name and then we want it to send back a response that says "Hello
   firstname lastname". This is simple enough so lets run through the steps .</p>
<ol type="1">
<li>Define the QMSUniqueName<ul>
<li>Explore the various probes available in QMS and the documentation to determine if the kind of data stream that you are generating already has a well-known QMSUniqueName/Category. In our case, it does not, so let's come up with a name. Since the Hello_World Sensor will have a conceptual probe built into it whose job is to produce Hello World messages, lets name it "HelloWorldProbe".</li>
</ul>
</li>
<li>Define the actions the Sensor must perform<ul>
<li>Determine the actions that you'd like the Sensor to perform. Let us say that we would like to be able to tell the Sensor to accept a request and send us data for 20 iterations at an interval of 5 seconds. We would also like to be able tell the Sensor to "pause", "resume" and "stop" when it is actively responding to a request.</li>
</ul>
</li>
</ol>
<p>Define the message format</p><ul>
<li>Specify a format for the request that the Sensor will receive and a format for the output that the Sensor will send. In our example, we want the request to contain a &lt;firstname&gt; and a &lt;lastname&gt; and the response will have the string &lt;salutation&gt;.</li>
<li>The QMS Message format already allows us to specify if we'd like the Sensor to execute the request for a specific number of iterations with a specific interval. So our request does not need to include this information. However, the request should support the definition of an &lt;action&gt; which will tell the Sensor to "pause" or "resume" etc. We do all of this specification using XML Schemas and save it in an XML Schema file - <em>helloWorld.xsd</em>.</li>
</ul>
<p>Create a Sensor Configuration File</p><ul>
<li>Now we have to create a configuration file that will give the Sensor relevant information that it will publish in the YPOffer. This could be any kind of information that we think may be useful for the clients of our Sensor's data. Since the Sensor is a QMS Citizen, it already supports the Command and Control CORBA interface. This needs to be specified in the configuration file. The Hello_World Sensor uses this information to make a YP Offer for its Command and Control Interface. This offer will be used in later evolutions of QMS.</li>
<li>Also our Sensor has exactly one builtin probe - the Hello_World Probe. So we specify parameters that are specific to this probe. We specify where the Sensor will find the Schema file that corresponds to the messages used by the Probe. We also choose to publish a couple of variable that we think will be useful to the clients that use our HelloWorldProbe data. A  variable and a &lt;author&gt; variable. All of this information will be published in the YPOffer that is made by the Hello_World Sensor on behalf of the HelloWorld Probe. See helloWorldConfig.xml for the format.</li>
<li>If you had more than one probe, you would specify multiple &lt;sensorService&gt; sections in the configuration file.</li>
</ul>
<p>Use the Hello_World Sensor as a template</p><ul>
<li>You need to go through a process similar to the one described above to create a message format and a sensor configuration file. Once that is done, you need to do two things:<ol type="1">
<li>Handle the incoming request. This is done by editing the <code>handle_query</code> method in the file <em><a class="el" href="Hello__World__Impl_8cpp.html" title="The implementation of the servant. ">Hello_World_Impl.cpp</a></em>. In the example, we use a callback function to the <code>parse_message</code> utility function to walk the DOM tree nodes and fill in a struct with the values from the message</li>
<li>Generate a response to the request. This is done by editing the <code>handle_query</code> method in the file editing the <code>handle_query</code> method in the file <em><a class="el" href="Meta__Data_8cpp.html" title="Implentation of the Metadata object containing metadata about probes. ">Meta_Data.cpp</a></em>. In the example, we use a <code>snprintf</code> statement and pull in data from several places to generate a response.</li>
</ol>
</li>
<li>Note that the Sensor code has to do different things based on the request. If the request specified multiple iterations, or a specific action, such as "pause", the Sensor code <em>handle_query</em> has to be changed to reflect the appropriate behaviour.</li>
</ul>
<div class="fragment"><div class="line">&lt;?xml <a class="code" href="ListOffers_8cpp.html#aa31f487a99743d24af9076a3e11e5425">version</a>=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;!--******************************************************************</div>
<div class="line"> * Copyright (c) 2001, System/Technology Development Corporation</div>
<div class="line"> *                </div>
<div class="line"> * Filename:      <a class="code" href="structhelloWorld.html">helloWorld</a>.xsd</div>
<div class="line"> * Version:       1.0</div>
<div class="line"> * Description:   Schema Description <span class="keywordflow">for</span> the HelloWorld Sensor</div>
<div class="line"> *                </div>
<div class="line"> * Author:        Amarendranath Vadlamudi &lt;amar.vadlamudi@stdc.com&gt;</div>
<div class="line"> * Created at:    Tue Oct 23 10:05:05 2001</div>
<div class="line"> * Modified by:   Amarendranath Vadlamudi &lt;amar.vadlamudi@stdc.com&gt;</div>
<div class="line"> * Modified at:   Wed Oct 24 18:54:25 2001</div>
<div class="line"> * Status:        Experimental, <span class="keywordflow">do</span> not distribute.</div>
<div class="line"> * Update <a class="code" href="Benchmark__Remos_8cpp.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>:  2</div>
<div class="line"> ******************************************************************--&gt;</div>
<div class="line"></div>
<div class="line">  &lt;xsd:schema xmlns:xsd=<span class="stringliteral">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></div>
<div class="line">    xmlns=<span class="stringliteral">&quot;http://www.stdc.com/2001/QMS/helloWorld&quot;</span></div>
<div class="line">    targetNamespace=<span class="stringliteral">&quot;http://www.stdc.com/2001/QMS/helloWorld&quot;</span></div>
<div class="line">    elementFormDefault=<span class="stringliteral">&quot;qualified&quot;</span></div>
<div class="line">    <a class="code" href="ListOffers_8cpp.html#aa31f487a99743d24af9076a3e11e5425">version</a>=<span class="stringliteral">&quot;$Id: helloWorld.xsd,v 1.5 2001/10/29 15:42:57 nath Exp $&quot;</span> &gt;</div>
<div class="line">  </div>
<div class="line">  &lt;xsd:complexType name=<span class="stringliteral">&quot;helloWorldRequestType&quot;</span>&gt;</div>
<div class="line">    &lt;xsd:annotation&gt;</div>
<div class="line">      &lt;xsd:documentation&gt;</div>
<div class="line">        The <a class="code" href="structRequest.html">Request</a> to the HelloWorld Sensor has to have two</div>
<div class="line">        parameters, name, lastname which implicitly starts a probe. </div>
<div class="line">        The action element can have several values and they determine</div>
<div class="line">        what the sensor does to pause, stop and resume the sensor.</div>
<div class="line">      &lt;/xsd:documentation&gt;</div>
<div class="line">    &lt;/xsd:annotation&gt;</div>
<div class="line">    &lt;xsd:choice&gt;</div>
<div class="line">      &lt;xsd:sequence&gt;</div>
<div class="line">        &lt;xsd:element name=<span class="stringliteral">&quot;firstname&quot;</span> type=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div>
<div class="line">        &lt;xsd:element name=<span class="stringliteral">&quot;lastname&quot;</span> type=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div>
<div class="line">      &lt;/xsd:sequence&gt;</div>
<div class="line">      &lt;xsd:element name=<span class="stringliteral">&quot;action&quot;</span>&gt;</div>
<div class="line">        &lt;xsd:simpleType&gt;</div>
<div class="line">          &lt;xsd:restriction base=<span class="stringliteral">&quot;xsd:string&quot;</span>&gt;</div>
<div class="line">            &lt;xsd:enumeration value=<span class="stringliteral">&quot;stop&quot;</span>/&gt;</div>
<div class="line">            &lt;xsd:enumeration value=<span class="stringliteral">&quot;pause&quot;</span>/&gt;</div>
<div class="line">            &lt;xsd:enumeration value=<span class="stringliteral">&quot;resume&quot;</span>/&gt;</div>
<div class="line">          &lt;/xsd:restriction&gt;</div>
<div class="line">        &lt;/xsd:simpleType&gt;</div>
<div class="line">      &lt;/xsd:element&gt;</div>
<div class="line">    &lt;/xsd:choice&gt;</div>
<div class="line">  &lt;/xsd:complexType&gt;</div>
<div class="line"></div>
<div class="line">  &lt;xsd:complexType name=<span class="stringliteral">&quot;helloWorldDataType&quot;</span>&gt;</div>
<div class="line">    &lt;xsd:annotation&gt;</div>
<div class="line">      &lt;xsd:documentation&gt;</div>
<div class="line">        This is the data that is returned by the Hello World sensor.</div>
<div class="line">      &lt;/xsd:documentation&gt;</div>
<div class="line">    &lt;/xsd:annotation&gt;</div>
<div class="line">    &lt;xsd:sequence&gt;</div>
<div class="line">      &lt;xsd:element name=<span class="stringliteral">&quot;dataid&quot;</span> type=<span class="stringliteral">&quot;xsd:nonNegativeInteger&quot;</span>/&gt;</div>
<div class="line">      &lt;xsd:element name=<span class="stringliteral">&quot;salutation&quot;</span> type=<span class="stringliteral">&quot;xsd:string&quot;</span>/&gt;</div>
<div class="line">    &lt;/xsd:sequence&gt;</div>
<div class="line">  &lt;/xsd:complexType&gt;</div>
<div class="line">  </div>
<div class="line">  &lt;xsd:element name=<span class="stringliteral">&quot;helloWorld&quot;</span>&gt;</div>
<div class="line">    &lt;xsd:complexType&gt;</div>
<div class="line">      &lt;xsd:choice&gt;</div>
<div class="line">        &lt;xsd:element name=<span class="stringliteral">&quot;Request&quot;</span> type=<span class="stringliteral">&quot;helloWorldRequestType&quot;</span>/&gt;</div>
<div class="line">        &lt;xsd:element name=<span class="stringliteral">&quot;Data&quot;</span> type=<span class="stringliteral">&quot;helloWorldDataType&quot;</span>/&gt;</div>
<div class="line">      &lt;/xsd:choice&gt;</div>
<div class="line">    &lt;/xsd:complexType&gt;</div>
<div class="line">  &lt;/xsd:element&gt;</div>
<div class="line">&lt;/xsd:schema&gt;</div>
<div class="line"></div>
</div><!-- fragment --><p><a class="el" href="README_8misc.html">Building your own QMS citizens</a> </p>
</div></div><!-- contents -->
    <table width="95%" border="7" frame="box" rules="none">
      <tbody align="center">
	<tr align="center">
	  <td align="center">
	    <table width="100%">
	      <colgroup width="25%">
		<col width="25%" align="left">
		<col span="2" width="25%" align="center">
		<col width="25%" align="right">
	      </colgroup>
	      <tbody align="center">
		<tr>
		  <td colspan="1" align="left">
		   <b>QoS Metrics Services</b> 
		  </td>
		  <td colspan="2" align="right" valign="top">
		    <a href="http://www.stdc.com/">
		      <img src="../images/logoonly.gif"
			   alt="S/TDC"  border=0
			   width=120  height=45>   
		    </a>
		  </td>
		  <td colspan="1" align="right">
		    <small id="xtiny">Revision: 1.2.1</small>
		  </td>
		</tr>
	      </tbody>
	    </table>
	  </td>
	</tr>
      </tbody>
    </table>
    <script type="text/javascript" language="JavaScript">
      <!--
      document.write("<p align=\"center\"><font size=\"-2\">Last Updated: ");
      document.writeln(document.lastModified);
        document.writeln("</font></p>");
      // -->
    </SCRIPT>
  </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-indent-data: t
sgml-live-element-indicator: t
sgml-set-face: t
End:
-->
