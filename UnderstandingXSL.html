<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <title>Understanding XML Stylesheets (XSL) in QMS</title>
    <meta http-equiv="keywords" content="Validation">
    <meta http-equiv="keywords" content="S/TDC">
    <meta http-equiv="keywords" content="QMS">
    <meta http-equiv="keywords" content="QoS">
    <meta http-equiv="keywords" content="Metrics">
    <meta http-equiv="keywords" content="Services">
    <link href="mailto:info@stdc.com" rev="made">
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <link href="../stylesheets/index.css" rel="stylesheet" type="text/css">
  </head>
  <body bgcolor="#ffffff">
    <p class="center">
      <a href="http://www.stdc.com/">
        <img class="center" src="../images/stdchead2logo.gif" alt="S/TDC"
	     border=0 height="42" width="629">
      </a>
   </p>
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Understanding XML Stylesheets (XSL) in QMS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>QMS has a clearly defined role for Sensors and Probes. The expectation is that Sensors can have builtin probes or external probes. The Generic Sensor is an example of a Sensor that supports external probes by communicating with them through simple pipes. It is conceivable that there will be other kinds of Sensors that support external probes and communicate with them through mechanisms such as sockets, IPC, shared memory etc.</p>
<p>Since such a Sensor will have no apriori knowledge of the probes that it will be deploying, it will have no knowledge of the parameters that the probe will require to operate, the format of its requests and its responses and so on. So QMS uses XSL to encapsulate this knowledge for each probe so that the Sensor can deploy these external probes.</p>
<p>Each external probe defines a specific XSL file - ProbeSample.xsl that is used in conjunction with its deployment. When the Sensor receives a QMS request that is destined for this probe, the Sensor sends the XML request and the XSL file to the XSLT processor, which will then produce an output that tells the sensor what to do. The output could indicate to the Sensor, that this request requires the sensor to deploy the probe with the following command line parameters. Or it could be telling the Sensor to send a message to the probe telling it to pause.</p>
<p>In the Continuous Simple Pipe probes that are currently implemented, deploying a probe means the Sensor will exec the probe executable with the appropriate command line parameters. Any modification requests are commands that are fed to the probe via the simple pipes. The primary XSL file defined for use by these Simple Pipe probes is QMSMessage.xsl. It defines the various templates that will be used by the Sensor in determining what actions to undertake.  <div class="fragment"></div><!-- fragment --></p>
<p>In the Documentation/XML/SensorCapability.xml file we see that the probe executable is /usr/local/bin/qms/remosProbe and the XSLT file that should be used for this probe is remosProbe.xsl.</p>
<p>In the Documentation/XML/ProbeSample.xml file that is written for the same probe that supports Documentation/XML/ProbeSchema.xsd, we see that the Probe supports on its input, commands such as "start,stop,pause,resume" and "count 25" and "interval
   PT200S". The first four are self-explanatory, the last two indicate to the probe to deliver 25 messages at an interval of 200 seconds. The XSL file is written to deliver all these messages appropriately from the Sensor to the probe.</p>
<p>The Sensor performs the following steps when it receives a message. First it calls a getAction template which tells it whether this is request requires the deployment of a new probe or a modification command to an existing probe. Depending on the output of the first command, the Sensor then calls the templates getExecString or getProbeString, which will again give the Sensor the command to fork/exec (deploying the probe) or the command to write to the input of the already deployed probe. Another template that is useful to the Sensor for its cleanup activities is whether the request will terminate the probe (getIsTerminate). The XSL files have comments that will further clarify the above. </p><div class="fragment"><div class="line">&lt;?xml <a class="code" href="ListOffers_8cpp.html#aa31f487a99743d24af9076a3e11e5425">version</a>=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;!-- *****************************************************************</div>
<div class="line"> *** Copyright (c) 2001, System/Technology Development Corporation .</div>
<div class="line"> ***                </div>
<div class="line"> *** Filename:      ProbeSample.xsl</div>
<div class="line"> *** Version:       1.0</div>
<div class="line"> *** Description:   XSL Transforms to build Probe commands</div>
<div class="line"> ***                </div>
<div class="line"> *** Author:        Amarendranath Vadlamudi &lt;amar.vadlamudi@stdc.com&gt;</div>
<div class="line"> *** Created at:    Mon Nov  26 11:30:03 2001</div>
<div class="line"> *** Modified by:   Amarendranath Vadlamudi &lt;nath@vedam&gt;</div>
<div class="line"> *** Modified at:   Fri Nov 30 20:01:24 2001</div>
<div class="line"> *** Status:        Experimental, <span class="keywordflow">do</span> not distribute.</div>
<div class="line"> *** Update <a class="code" href="Benchmark__Remos_8cpp.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>:  1</div>
<div class="line"> ***************************************************************** --&gt;</div>
<div class="line"></div>
<div class="line">&lt;xsl:stylesheet xmlns:xsl=<span class="stringliteral">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span></div>
<div class="line">  xmlns:qms=<span class="stringliteral">&quot;http://www.stdc.com/2001/QMSSchema&quot;</span></div>
<div class="line">  xmlns:probe=<span class="stringliteral">&quot;http://www.stdc.com/2001/QMS/Probes/Continuous/Probe&quot;</span></div>
<div class="line">  <a class="code" href="ListOffers_8cpp.html#aa31f487a99743d24af9076a3e11e5425">version</a>=<span class="stringliteral">&quot;$Id: ProbeSample.xsl,v 1.1 2001/12/09 02:14:58 nath Exp $&quot;</span>&gt;</div>
<div class="line"></div>
<div class="line">  &lt;!-- This variable is a mandatory definition <span class="keywordflow">for</span> every probe. This</div>
<div class="line">  is used initially to verify that the <span class="keyword">namespace </span>used by the payload</div>
<div class="line">  is actually the namespace we are expecting, i.e. probe: --&gt;</div>
<div class="line">  &lt;xsl:variable name=&quot;payloadRoot&quot;</div>
<div class="line">    select=&quot;name(/qms:QMSMessage/qms:payload/probe:*[1])&quot;/&gt;</div>
<div class="line">  </div>
<div class="line">  &lt;!-- Include the primary XSL definitions that will be used by all</div>
<div class="line">  Sensors in QMS where the template names and variables are defined. --&gt;</div>
<div class="line">  &lt;xsl:include href=&quot;QMSMessage.xsl&quot;/&gt;</div>
<div class="line">    </div>
<div class="line">  &lt;!-- Defining some easy access tags. The Generic Probe</div>
<div class="line">  Schema defines the action element that controls the execution of the</div>
<div class="line">  probes. This is the element we&#39;re accessing here.--&gt; </div>
<div class="line"></div>
<div class="line">  &lt;xsl:variable</div>
<div class="line">    name=&quot;payloadElement&quot;</div>
<div class="line">    select=&quot;/qms:QMSMessage/qms:payload/probe:Probe&quot;/&gt;</div>
<div class="line">  &lt;xsl:variable</div>
<div class="line">    name=&quot;action&quot;</div>
<div class="line">    select=&quot;$payloadElement/probe:probeRequest/probe:probeControl/probe:action&quot;/&gt;</div>
<div class="line"></div>
<div class="line">  &lt;!-- Template: buildAction</div>
<div class="line">  This template serves as the mechanism used by the Sensor to</div>
<div class="line">  determine what to do with the request. The result indicates to the</div>
<div class="line">  Sensor if the probe is to be exec&#39;ed (Decision=exec), a command is</div>
<div class="line">  to sent to the probe (Decision=write-to-pipe) or nothing is to be</div>
<div class="line">  done (Decision=noaction). The Sensor also passes the msgType</div>
<div class="line">  parameter to the template after determining if the message is a</div>
<div class="line">  &quot;new&quot; message or a &quot;modify&quot; message --&gt;</div>
<div class="line">  </div>
<div class="line">  &lt;xsl:template name=&quot;buildAction&quot;&gt;</div>
<div class="line"></div>
<div class="line">    &lt;!-- This parameter is received as an input parameter from the</div>
<div class="line">    calling entity --&gt;</div>
<div class="line">  </div>
<div class="line">    &lt;xsl:param name=&quot;msgType&quot;/&gt;</div>
<div class="line"></div>
<div class="line">    &lt;!-- This parameter is received as an input parameter from the</div>
<div class="line">    calling entity. This is generally not used in the regular</div>
<div class="line">    operation of the Sensor. Can be useful as a debugging tool.Default</div>
<div class="line">    value is false. --&gt; </div>
<div class="line">    </div>
<div class="line">    &lt;xsl:param name=&quot;verbose&quot;/&gt;</div>
<div class="line"></div>
<div class="line">    &lt;!-- Set isRequest variable once we determine if the message is a</div>
<div class="line">    legitimate request for this probe --&gt;</div>
<div class="line">    &lt;xsl:variable name=&quot;isRequest&quot;&gt;</div>
<div class="line">      &lt;xsl:for-each select=&quot;$payloadElement<span class="comment">/*[1]&quot;&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:value-of select=&quot;name(.)=&#39;probeRequest&#39;&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:for-each&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:variable&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- Debug messages --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:if test=&quot;($verbose=&#39;true&#39;)&quot;&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Message Type = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:value-of select=&quot;$msgType&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Request Message = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:value-of select=&quot;$isRequest&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Decision = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:if&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- A new request needs to be exec&#39;ed, while a modify request</span></div>
<div class="line"><span class="comment">    needs to send a command to an existing probe. A catchall</span></div>
<div class="line"><span class="comment">    &quot;noaction&quot; at the end for all other cases --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:choose&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:when test=&quot;($isRequest=&#39;true&#39;) and ($msgType=&#39;modify&#39;)&quot;&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:text&gt;write-to-pipe&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:when&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:when test=&quot;($isRequest=&#39;true&#39;) and ($msgType=&#39;new&#39;)&quot;&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:text&gt;exec&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:when&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:otherwise&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:text&gt;noaction&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:otherwise&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:choose&gt;</span></div>
<div class="line"><span class="comment">  &lt;/xsl:template&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  &lt;!-- Template: buildExecString</span></div>
<div class="line"><span class="comment">  This template provides the Executable String which the Sensor</span></div>
<div class="line"><span class="comment">  will use to Exec the probe instance --&gt;</span></div>
<div class="line"><span class="comment">  &lt;xsl:template name=&quot;buildExecString&quot;&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- This parameter is received as an input parameter from the</span></div>
<div class="line"><span class="comment">    calling entity. Default value is false. --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:param name=&quot;verbose&quot;/&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- Verbose output is on --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:if test=&quot;($verbose=&#39;true&#39;)&quot;&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Repetitions = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:value-of select=&quot;$repetitions&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Interval = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:value-of select=&quot;$interval&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Command Line = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:if&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;xsl:text&gt;-r&amp;#xA;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$repetitions&quot;/&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:text&gt;&amp;#xA;-i&amp;#xA;&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;$interval&quot;/&gt;</span></div>
<div class="line"><span class="comment">  &lt;/xsl:template&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  &lt;!-- Template: buildProbeString</span></div>
<div class="line"><span class="comment">  Get the message to Write to the Pipe </span></div>
<div class="line"><span class="comment">  There are two kinds of messages that we can write to the pipe.</span></div>
<div class="line"><span class="comment">  1. A message that indicates the parameters to change the behaviour</span></div>
<div class="line"><span class="comment">  of the data collection</span></div>
<div class="line"><span class="comment">  2. A message that controls the execution of the pipe --&gt;</span></div>
<div class="line"><span class="comment">  &lt;xsl:template name=&quot;buildProbeString&quot;&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- This parameter is received as an input parameter from the</span></div>
<div class="line"><span class="comment">    calling entity. Default value is false. --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:param name=&quot;verbose&quot;/&gt;</span></div>
<div class="line"><span class="comment">    </span></div>
<div class="line"><span class="comment">    &lt;!-- According to the perfmonProbes.xsd schema, the control messages</span></div>
<div class="line"><span class="comment">    are specified in a probeControl element. So if the probeControl</span></div>
<div class="line"><span class="comment">    element exists, then this is a control message --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:variable name=&quot;isControlMessage&quot;&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:for-each select=&quot;$payloadElement/probe:probeRequest/*[1]&quot;&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:value-of select=&quot;name(.)=&#39;probeControl&#39;&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:for-each&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:variable&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- Verbose output is on --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:if test=&quot;($verbose=&#39;true&#39;)&quot;&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Is this a Control Message = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:value-of select=&quot;$isControlMessage&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;Probe String for Pipe = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:if&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;xsl:choose&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:when test=&quot;$isControlMessage=&#39;true&#39;&quot;&gt;</span></div>
<div class="line"><span class="comment">        &lt;!-- This is a control message --&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:value-of select=&quot;concat($action, &#39;&amp;#xA;&#39;)&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:when&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:otherwise&gt;</span></div>
<div class="line"><span class="comment">        &lt;!-- This is a request for a specific action --&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:value-of select=&quot;concat(&#39;count,&#39;, $repetitions, &#39;&amp;#xA;&#39;)&quot;/&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:value-of select=&quot;concat(&#39;intrval,&#39;, $interval)&quot;/&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:otherwise&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:choose&gt;</span></div>
<div class="line"><span class="comment">  &lt;/xsl:template&gt;</span></div>
<div class="line"><span class="comment">  </span></div>
<div class="line"><span class="comment">  &lt;!-- Template: isTerminate</span></div>
<div class="line"><span class="comment">  If this request is a terminate request, tell the sensor so.</span></div>
<div class="line"><span class="comment">  Note that the Sensor has already determined that this is a valid </span></div>
<div class="line"><span class="comment">  modify message for a valid request, so there is no need to redo the</span></div>
<div class="line"><span class="comment">  check here.--&gt;</span></div>
<div class="line"><span class="comment">  &lt;xsl:template name=&quot;isTerminate&quot;&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- This parameter is received as an input parameter from the</span></div>
<div class="line"><span class="comment">    calling entity. Default value is false. --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:param name=&quot;verbose&quot;/&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;!-- Verbose output is on --&gt;</span></div>
<div class="line"><span class="comment">    &lt;xsl:if test=&quot;($verbose=&#39;true&#39;)&quot;&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:text&gt;isTerminate = &lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:if&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    &lt;xsl:choose&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:when test=&quot;$action=&#39;stop&#39;&quot;&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:text&gt;true&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:when&gt;</span></div>
<div class="line"><span class="comment">      &lt;xsl:otherwise&gt;</span></div>
<div class="line"><span class="comment">        &lt;xsl:text&gt;false&lt;/xsl:text&gt;</span></div>
<div class="line"><span class="comment">      &lt;/xsl:otherwise&gt;</span></div>
<div class="line"><span class="comment">    &lt;/xsl:choose&gt;</span></div>
<div class="line"><span class="comment">  &lt;/xsl:template&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">&lt;/xsl:stylesheet&gt;</span></div>
</div><!-- fragment --><p><a class="el" href="README_8misc.html">Building your own QMS citizens</a> </p>
</div></div><!-- contents -->
    <table width="95%" border="7" frame="box" rules="none">
      <tbody align="center">
	<tr align="center">
	  <td align="center">
	    <table width="100%">
	      <colgroup width="25%">
		<col width="25%" align="left">
		<col span="2" width="25%" align="center">
		<col width="25%" align="right">
	      </colgroup>
	      <tbody align="center">
		<tr>
		  <td colspan="1" align="left">
		   <b>QoS Metrics Services</b> 
		  </td>
		  <td colspan="2" align="right" valign="top">
		    <a href="http://www.stdc.com/">
		      <img src="../images/logoonly.gif"
			   alt="S/TDC"  border=0
			   width=120  height=45>   
		    </a>
		  </td>
		  <td colspan="1" align="right">
		    <small id="xtiny">Revision: 1.2.1</small>
		  </td>
		</tr>
	      </tbody>
	    </table>
	  </td>
	</tr>
      </tbody>
    </table>
    <script type="text/javascript" language="JavaScript">
      <!--
      document.write("<p align=\"center\"><font size=\"-2\">Last Updated: ");
      document.writeln(document.lastModified);
        document.writeln("</font></p>");
      // -->
    </SCRIPT>
  </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-indent-data: t
sgml-live-element-indicator: t
sgml-set-face: t
End:
-->
